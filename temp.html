<!DOCTYPE html>
<html>
    <head>
        <meta charset=UTF-8>
        <title>Tomcat WebSocket Chat</title>
        <script>
        </script>
    </head>
    <body>
        <div><h1>Current Temperature: <span  id="currenttemp"></span> F</h1></div>
        <div id="chartContainer" style="height: 300px; width:100%;"></div>


        <div id="data"></div><!-- 
        <textarea id="chatlog" readonly></textarea><br/>
        <input id="msg" type="text" />
        <button type="submit" id="sendButton" onClick="postToServer()">Send!</button>
        <button type="submit" id="sendButton" onClick="closeConnect()">End</button> -->


    <script type="text/javascript">
    function parseIsoDatetime(dtstr) {
        var dt = dtstr.split(/[: T-]/).map(parseFloat);
        return new Date(dt[0], dt[1] - 1, dt[2], dt[3] || 0, dt[4] || 0, dt[5] || 0, 0);
    }

    window.onload = function () {
        var ws = new WebSocket("ws://localhost:8080/bbq/websocket/bbq");
        ws.onopen = function(){
        };
        ws.onmessage = function(message){
            //document.getElementById("data").innerHTML += message.data+"<br>";
            var obj = JSON.parse(message.data);
            var clientid = obj['clientid'];
            var xval = parseIsoDatetime(obj['timestamp']);
            var yval = obj['value'];
            document.getElementById("currenttemp").innerHTML = yval;
            updateChart(xval,yval);
        };
        function postToServer(){
            ws.send(document.getElementById("msg").value);
            document.getElementById("msg").value = "";
        }
        function closeConnect(){
            ws.close();
        }


        var dps = []; // dataPoints

        var chart = new CanvasJS.Chart("chartContainer",{
            title :{
                text: "Current Temperature Data"
            },
            axisX:{
                title: "Time",
                gridThickness: 2,
                intervalType: "hour",        
                valueFormatString: "hh:MM:ss TT", 
                labelAngle: -20
            },
            axisY: {
                title: "Temperature"
            },       
            data: [{
                type: "line",
                dataPoints: dps 
            }]
        });

        var xVal = 0;
        var yVal = 100;
        var updateInterval = 100;
        var dataLength = 500; // number of dataPoints visible at any point

        var updateChart = function (xval,yval) {
            
            dps.push({
                x: xval,
                y: yval
            });
        
            if (dps.length > dataLength)
            {
                dps.shift();                
            }
            
            chart.render();     

        };
    }
    </script>
    <script type="text/javascript" src="canvasjs.min.js"></script>
    </body>
</html>